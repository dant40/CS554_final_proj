{"ast":null,"code":"/**\r\n * @author       Richard Davey <rich@photonstorm.com>\r\n * @copyright    2020 Photon Storm Ltd.\r\n * @license      {@link https://opensource.org/licenses/MIT|MIT License}\r\n */\n//  Earcut 2.1.4 (December 4th 2018)\n\n/*\r\n * ISC License\r\n * \r\n * Copyright (c) 2016, Mapbox\r\n * \r\n * Permission to use, copy, modify, and/or distribute this software for any purpose\r\n * with or without fee is hereby granted, provided that the above copyright notice\r\n * and this permission notice appear in all copies.\r\n * \r\n * THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\n * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND\r\n * FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\n * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\r\n * OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER\r\n * TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF\r\n * THIS SOFTWARE.\r\n */\n'use strict';\n\nmodule.exports = earcut;\n\nfunction earcut(data, holeIndices, dim) {\n  dim = dim || 2;\n  var hasHoles = holeIndices && holeIndices.length,\n      outerLen = hasHoles ? holeIndices[0] * dim : data.length,\n      outerNode = linkedList(data, 0, outerLen, dim, true),\n      triangles = [];\n  if (!outerNode || outerNode.next === outerNode.prev) return triangles;\n  var minX, minY, maxX, maxY, x, y, invSize;\n  if (hasHoles) outerNode = eliminateHoles(data, holeIndices, outerNode, dim); // if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox\n\n  if (data.length > 80 * dim) {\n    minX = maxX = data[0];\n    minY = maxY = data[1];\n\n    for (var i = dim; i < outerLen; i += dim) {\n      x = data[i];\n      y = data[i + 1];\n      if (x < minX) minX = x;\n      if (y < minY) minY = y;\n      if (x > maxX) maxX = x;\n      if (y > maxY) maxY = y;\n    } // minX, minY and invSize are later used to transform coords into integers for z-order calculation\n\n\n    invSize = Math.max(maxX - minX, maxY - minY);\n    invSize = invSize !== 0 ? 1 / invSize : 0;\n  }\n\n  earcutLinked(outerNode, triangles, dim, minX, minY, invSize);\n  return triangles;\n} // create a circular doubly linked list from polygon points in the specified winding order\n\n\nfunction linkedList(data, start, end, dim, clockwise) {\n  var i, last;\n\n  if (clockwise === signedArea(data, start, end, dim) > 0) {\n    for (i = start; i < end; i += dim) last = insertNode(i, data[i], data[i + 1], last);\n  } else {\n    for (i = end - dim; i >= start; i -= dim) last = insertNode(i, data[i], data[i + 1], last);\n  }\n\n  if (last && equals(last, last.next)) {\n    removeNode(last);\n    last = last.next;\n  }\n\n  return last;\n} // eliminate collinear or duplicate points\n\n\nfunction filterPoints(start, end) {\n  if (!start) return start;\n  if (!end) end = start;\n  var p = start,\n      again;\n\n  do {\n    again = false;\n\n    if (!p.steiner && (equals(p, p.next) || area(p.prev, p, p.next) === 0)) {\n      removeNode(p);\n      p = end = p.prev;\n      if (p === p.next) break;\n      again = true;\n    } else {\n      p = p.next;\n    }\n  } while (again || p !== end);\n\n  return end;\n} // main ear slicing loop which triangulates a polygon (given as a linked list)\n\n\nfunction earcutLinked(ear, triangles, dim, minX, minY, invSize, pass) {\n  if (!ear) return; // interlink polygon nodes in z-order\n\n  if (!pass && invSize) indexCurve(ear, minX, minY, invSize);\n  var stop = ear,\n      prev,\n      next; // iterate through ears, slicing them one by one\n\n  while (ear.prev !== ear.next) {\n    prev = ear.prev;\n    next = ear.next;\n\n    if (invSize ? isEarHashed(ear, minX, minY, invSize) : isEar(ear)) {\n      // cut off the triangle\n      triangles.push(prev.i / dim);\n      triangles.push(ear.i / dim);\n      triangles.push(next.i / dim);\n      removeNode(ear); // skipping the next vertex leads to less sliver triangles\n\n      ear = next.next;\n      stop = next.next;\n      continue;\n    }\n\n    ear = next; // if we looped through the whole remaining polygon and can't find any more ears\n\n    if (ear === stop) {\n      // try filtering points and slicing again\n      if (!pass) {\n        earcutLinked(filterPoints(ear), triangles, dim, minX, minY, invSize, 1); // if this didn't work, try curing all small self-intersections locally\n      } else if (pass === 1) {\n        ear = cureLocalIntersections(ear, triangles, dim);\n        earcutLinked(ear, triangles, dim, minX, minY, invSize, 2); // as a last resort, try splitting the remaining polygon into two\n      } else if (pass === 2) {\n        splitEarcut(ear, triangles, dim, minX, minY, invSize);\n      }\n\n      break;\n    }\n  }\n} // check whether a polygon node forms a valid ear with adjacent nodes\n\n\nfunction isEar(ear) {\n  var a = ear.prev,\n      b = ear,\n      c = ear.next;\n  if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\n  // now make sure we don't have other points inside the potential ear\n\n  var p = ear.next.next;\n\n  while (p !== ear.prev) {\n    if (pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) && area(p.prev, p, p.next) >= 0) return false;\n    p = p.next;\n  }\n\n  return true;\n}\n\nfunction isEarHashed(ear, minX, minY, invSize) {\n  var a = ear.prev,\n      b = ear,\n      c = ear.next;\n  if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\n  // triangle bbox; min & max are calculated like this for speed\n\n  var minTX = a.x < b.x ? a.x < c.x ? a.x : c.x : b.x < c.x ? b.x : c.x,\n      minTY = a.y < b.y ? a.y < c.y ? a.y : c.y : b.y < c.y ? b.y : c.y,\n      maxTX = a.x > b.x ? a.x > c.x ? a.x : c.x : b.x > c.x ? b.x : c.x,\n      maxTY = a.y > b.y ? a.y > c.y ? a.y : c.y : b.y > c.y ? b.y : c.y; // z-order range for the current triangle bbox;\n\n  var minZ = zOrder(minTX, minTY, minX, minY, invSize),\n      maxZ = zOrder(maxTX, maxTY, minX, minY, invSize);\n  var p = ear.prevZ,\n      n = ear.nextZ; // look for points inside the triangle in both directions\n\n  while (p && p.z >= minZ && n && n.z <= maxZ) {\n    if (p !== ear.prev && p !== ear.next && pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) && area(p.prev, p, p.next) >= 0) return false;\n    p = p.prevZ;\n    if (n !== ear.prev && n !== ear.next && pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, n.x, n.y) && area(n.prev, n, n.next) >= 0) return false;\n    n = n.nextZ;\n  } // look for remaining points in decreasing z-order\n\n\n  while (p && p.z >= minZ) {\n    if (p !== ear.prev && p !== ear.next && pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) && area(p.prev, p, p.next) >= 0) return false;\n    p = p.prevZ;\n  } // look for remaining points in increasing z-order\n\n\n  while (n && n.z <= maxZ) {\n    if (n !== ear.prev && n !== ear.next && pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, n.x, n.y) && area(n.prev, n, n.next) >= 0) return false;\n    n = n.nextZ;\n  }\n\n  return true;\n} // go through all polygon nodes and cure small local self-intersections\n\n\nfunction cureLocalIntersections(start, triangles, dim) {\n  var p = start;\n\n  do {\n    var a = p.prev,\n        b = p.next.next;\n\n    if (!equals(a, b) && intersects(a, p, p.next, b) && locallyInside(a, b) && locallyInside(b, a)) {\n      triangles.push(a.i / dim);\n      triangles.push(p.i / dim);\n      triangles.push(b.i / dim); // remove two nodes involved\n\n      removeNode(p);\n      removeNode(p.next);\n      p = start = b;\n    }\n\n    p = p.next;\n  } while (p !== start);\n\n  return p;\n} // try splitting polygon into two and triangulate them independently\n\n\nfunction splitEarcut(start, triangles, dim, minX, minY, invSize) {\n  // look for a valid diagonal that divides the polygon into two\n  var a = start;\n\n  do {\n    var b = a.next.next;\n\n    while (b !== a.prev) {\n      if (a.i !== b.i && isValidDiagonal(a, b)) {\n        // split the polygon in two by the diagonal\n        var c = splitPolygon(a, b); // filter collinear points around the cuts\n\n        a = filterPoints(a, a.next);\n        c = filterPoints(c, c.next); // run earcut on each half\n\n        earcutLinked(a, triangles, dim, minX, minY, invSize);\n        earcutLinked(c, triangles, dim, minX, minY, invSize);\n        return;\n      }\n\n      b = b.next;\n    }\n\n    a = a.next;\n  } while (a !== start);\n} // link every hole into the outer loop, producing a single-ring polygon without holes\n\n\nfunction eliminateHoles(data, holeIndices, outerNode, dim) {\n  var queue = [],\n      i,\n      len,\n      start,\n      end,\n      list;\n\n  for (i = 0, len = holeIndices.length; i < len; i++) {\n    start = holeIndices[i] * dim;\n    end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\n    list = linkedList(data, start, end, dim, false);\n    if (list === list.next) list.steiner = true;\n    queue.push(getLeftmost(list));\n  }\n\n  queue.sort(compareX); // process holes from left to right\n\n  for (i = 0; i < queue.length; i++) {\n    eliminateHole(queue[i], outerNode);\n    outerNode = filterPoints(outerNode, outerNode.next);\n  }\n\n  return outerNode;\n}\n\nfunction compareX(a, b) {\n  return a.x - b.x;\n} // find a bridge between vertices that connects hole with an outer ring and and link it\n\n\nfunction eliminateHole(hole, outerNode) {\n  outerNode = findHoleBridge(hole, outerNode);\n\n  if (outerNode) {\n    var b = splitPolygon(outerNode, hole);\n    filterPoints(b, b.next);\n  }\n} // David Eberly's algorithm for finding a bridge between hole and outer polygon\n\n\nfunction findHoleBridge(hole, outerNode) {\n  var p = outerNode,\n      hx = hole.x,\n      hy = hole.y,\n      qx = -Infinity,\n      m; // find a segment intersected by a ray from the hole's leftmost point to the left;\n  // segment's endpoint with lesser x will be potential connection point\n\n  do {\n    if (hy <= p.y && hy >= p.next.y && p.next.y !== p.y) {\n      var x = p.x + (hy - p.y) * (p.next.x - p.x) / (p.next.y - p.y);\n\n      if (x <= hx && x > qx) {\n        qx = x;\n\n        if (x === hx) {\n          if (hy === p.y) return p;\n          if (hy === p.next.y) return p.next;\n        }\n\n        m = p.x < p.next.x ? p : p.next;\n      }\n    }\n\n    p = p.next;\n  } while (p !== outerNode);\n\n  if (!m) return null;\n  if (hx === qx) return m.prev; // hole touches outer segment; pick lower endpoint\n  // look for points inside the triangle of hole point, segment intersection and endpoint;\n  // if there are no points found, we have a valid connection;\n  // otherwise choose the point of the minimum angle with the ray as connection point\n\n  var stop = m,\n      mx = m.x,\n      my = m.y,\n      tanMin = Infinity,\n      tan;\n  p = m.next;\n\n  while (p !== stop) {\n    if (hx >= p.x && p.x >= mx && hx !== p.x && pointInTriangle(hy < my ? hx : qx, hy, mx, my, hy < my ? qx : hx, hy, p.x, p.y)) {\n      tan = Math.abs(hy - p.y) / (hx - p.x); // tangential\n\n      if ((tan < tanMin || tan === tanMin && p.x > m.x) && locallyInside(p, hole)) {\n        m = p;\n        tanMin = tan;\n      }\n    }\n\n    p = p.next;\n  }\n\n  return m;\n} // interlink polygon nodes in z-order\n\n\nfunction indexCurve(start, minX, minY, invSize) {\n  var p = start;\n\n  do {\n    if (p.z === null) p.z = zOrder(p.x, p.y, minX, minY, invSize);\n    p.prevZ = p.prev;\n    p.nextZ = p.next;\n    p = p.next;\n  } while (p !== start);\n\n  p.prevZ.nextZ = null;\n  p.prevZ = null;\n  sortLinked(p);\n} // Simon Tatham's linked list merge sort algorithm\n// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html\n\n\nfunction sortLinked(list) {\n  var i,\n      p,\n      q,\n      e,\n      tail,\n      numMerges,\n      pSize,\n      qSize,\n      inSize = 1;\n\n  do {\n    p = list;\n    list = null;\n    tail = null;\n    numMerges = 0;\n\n    while (p) {\n      numMerges++;\n      q = p;\n      pSize = 0;\n\n      for (i = 0; i < inSize; i++) {\n        pSize++;\n        q = q.nextZ;\n        if (!q) break;\n      }\n\n      qSize = inSize;\n\n      while (pSize > 0 || qSize > 0 && q) {\n        if (pSize !== 0 && (qSize === 0 || !q || p.z <= q.z)) {\n          e = p;\n          p = p.nextZ;\n          pSize--;\n        } else {\n          e = q;\n          q = q.nextZ;\n          qSize--;\n        }\n\n        if (tail) tail.nextZ = e;else list = e;\n        e.prevZ = tail;\n        tail = e;\n      }\n\n      p = q;\n    }\n\n    tail.nextZ = null;\n    inSize *= 2;\n  } while (numMerges > 1);\n\n  return list;\n} // z-order of a point given coords and inverse of the longer side of data bbox\n\n\nfunction zOrder(x, y, minX, minY, invSize) {\n  // coords are transformed into non-negative 15-bit integer range\n  x = 32767 * (x - minX) * invSize;\n  y = 32767 * (y - minY) * invSize;\n  x = (x | x << 8) & 0x00FF00FF;\n  x = (x | x << 4) & 0x0F0F0F0F;\n  x = (x | x << 2) & 0x33333333;\n  x = (x | x << 1) & 0x55555555;\n  y = (y | y << 8) & 0x00FF00FF;\n  y = (y | y << 4) & 0x0F0F0F0F;\n  y = (y | y << 2) & 0x33333333;\n  y = (y | y << 1) & 0x55555555;\n  return x | y << 1;\n} // find the leftmost node of a polygon ring\n\n\nfunction getLeftmost(start) {\n  var p = start,\n      leftmost = start;\n\n  do {\n    if (p.x < leftmost.x) leftmost = p;\n    p = p.next;\n  } while (p !== start);\n\n  return leftmost;\n} // check if a point lies within a convex triangle\n\n\nfunction pointInTriangle(ax, ay, bx, by, cx, cy, px, py) {\n  return (cx - px) * (ay - py) - (ax - px) * (cy - py) >= 0 && (ax - px) * (by - py) - (bx - px) * (ay - py) >= 0 && (bx - px) * (cy - py) - (cx - px) * (by - py) >= 0;\n} // check if a diagonal between two polygon nodes is valid (lies in polygon interior)\n\n\nfunction isValidDiagonal(a, b) {\n  return a.next.i !== b.i && a.prev.i !== b.i && !intersectsPolygon(a, b) && locallyInside(a, b) && locallyInside(b, a) && middleInside(a, b);\n} // signed area of a triangle\n\n\nfunction area(p, q, r) {\n  return (q.y - p.y) * (r.x - q.x) - (q.x - p.x) * (r.y - q.y);\n} // check if two points are equal\n\n\nfunction equals(p1, p2) {\n  return p1.x === p2.x && p1.y === p2.y;\n} // check if two segments intersect\n\n\nfunction intersects(p1, q1, p2, q2) {\n  if (equals(p1, q1) && equals(p2, q2) || equals(p1, q2) && equals(p2, q1)) return true;\n  return area(p1, q1, p2) > 0 !== area(p1, q1, q2) > 0 && area(p2, q2, p1) > 0 !== area(p2, q2, q1) > 0;\n} // check if a polygon diagonal intersects any polygon segments\n\n\nfunction intersectsPolygon(a, b) {\n  var p = a;\n\n  do {\n    if (p.i !== a.i && p.next.i !== a.i && p.i !== b.i && p.next.i !== b.i && intersects(p, p.next, a, b)) return true;\n    p = p.next;\n  } while (p !== a);\n\n  return false;\n} // check if a polygon diagonal is locally inside the polygon\n\n\nfunction locallyInside(a, b) {\n  return area(a.prev, a, a.next) < 0 ? area(a, b, a.next) >= 0 && area(a, a.prev, b) >= 0 : area(a, b, a.prev) < 0 || area(a, a.next, b) < 0;\n} // check if the middle point of a polygon diagonal is inside the polygon\n\n\nfunction middleInside(a, b) {\n  var p = a,\n      inside = false,\n      px = (a.x + b.x) / 2,\n      py = (a.y + b.y) / 2;\n\n  do {\n    if (p.y > py !== p.next.y > py && p.next.y !== p.y && px < (p.next.x - p.x) * (py - p.y) / (p.next.y - p.y) + p.x) inside = !inside;\n    p = p.next;\n  } while (p !== a);\n\n  return inside;\n} // link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;\n// if one belongs to the outer ring and another to a hole, it merges it into a single ring\n\n\nfunction splitPolygon(a, b) {\n  var a2 = new Node(a.i, a.x, a.y),\n      b2 = new Node(b.i, b.x, b.y),\n      an = a.next,\n      bp = b.prev;\n  a.next = b;\n  b.prev = a;\n  a2.next = an;\n  an.prev = a2;\n  b2.next = a2;\n  a2.prev = b2;\n  bp.next = b2;\n  b2.prev = bp;\n  return b2;\n} // create a node and optionally link it with previous one (in a circular doubly linked list)\n\n\nfunction insertNode(i, x, y, last) {\n  var p = new Node(i, x, y);\n\n  if (!last) {\n    p.prev = p;\n    p.next = p;\n  } else {\n    p.next = last.next;\n    p.prev = last;\n    last.next.prev = p;\n    last.next = p;\n  }\n\n  return p;\n}\n\nfunction removeNode(p) {\n  p.next.prev = p.prev;\n  p.prev.next = p.next;\n  if (p.prevZ) p.prevZ.nextZ = p.nextZ;\n  if (p.nextZ) p.nextZ.prevZ = p.prevZ;\n}\n\nfunction Node(i, x, y) {\n  // vertex index in coordinates array\n  this.i = i; // vertex coordinates\n\n  this.x = x;\n  this.y = y; // previous and next vertex nodes in a polygon ring\n\n  this.prev = null;\n  this.next = null; // z-order curve value\n\n  this.z = null; // previous and next nodes in z-order\n\n  this.prevZ = null;\n  this.nextZ = null; // indicates whether this is a steiner point\n\n  this.steiner = false;\n} // return a percentage difference between the polygon area and its triangulation area;\n// used to verify correctness of triangulation\n\n\nearcut.deviation = function (data, holeIndices, dim, triangles) {\n  var hasHoles = holeIndices && holeIndices.length;\n  var outerLen = hasHoles ? holeIndices[0] * dim : data.length;\n  var polygonArea = Math.abs(signedArea(data, 0, outerLen, dim));\n\n  if (hasHoles) {\n    for (var i = 0, len = holeIndices.length; i < len; i++) {\n      var start = holeIndices[i] * dim;\n      var end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\n      polygonArea -= Math.abs(signedArea(data, start, end, dim));\n    }\n  }\n\n  var trianglesArea = 0;\n\n  for (i = 0; i < triangles.length; i += 3) {\n    var a = triangles[i] * dim;\n    var b = triangles[i + 1] * dim;\n    var c = triangles[i + 2] * dim;\n    trianglesArea += Math.abs((data[a] - data[c]) * (data[b + 1] - data[a + 1]) - (data[a] - data[b]) * (data[c + 1] - data[a + 1]));\n  }\n\n  return polygonArea === 0 && trianglesArea === 0 ? 0 : Math.abs((trianglesArea - polygonArea) / polygonArea);\n};\n\nfunction signedArea(data, start, end, dim) {\n  var sum = 0;\n\n  for (var i = start, j = end - dim; i < end; i += dim) {\n    sum += (data[j] - data[i]) * (data[i + 1] + data[j + 1]);\n    j = i;\n  }\n\n  return sum;\n} // turn a polygon in a multi-dimensional array form (e.g. as in GeoJSON) into a form Earcut accepts\n\n\nearcut.flatten = function (data) {\n  var dim = data[0][0].length,\n      result = {\n    vertices: [],\n    holes: [],\n    dimensions: dim\n  },\n      holeIndex = 0;\n\n  for (var i = 0; i < data.length; i++) {\n    for (var j = 0; j < data[i].length; j++) {\n      for (var d = 0; d < dim; d++) result.vertices.push(data[i][j][d]);\n    }\n\n    if (i > 0) {\n      holeIndex += data[i - 1].length;\n      result.holes.push(holeIndex);\n    }\n  }\n\n  return result;\n};","map":{"version":3,"sources":["/mnt/c/Users/kubec/Desktop/Projects/Projects/Phaser/phaser_practice/node_modules/phaser/src/geom/polygon/Earcut.js"],"names":["module","exports","earcut","data","holeIndices","dim","hasHoles","length","outerLen","outerNode","linkedList","triangles","next","prev","minX","minY","maxX","maxY","x","y","invSize","eliminateHoles","i","Math","max","earcutLinked","start","end","clockwise","last","signedArea","insertNode","equals","removeNode","filterPoints","p","again","steiner","area","ear","pass","indexCurve","stop","isEarHashed","isEar","push","cureLocalIntersections","splitEarcut","a","b","c","pointInTriangle","minTX","minTY","maxTX","maxTY","minZ","zOrder","maxZ","prevZ","n","nextZ","z","intersects","locallyInside","isValidDiagonal","splitPolygon","queue","len","list","getLeftmost","sort","compareX","eliminateHole","hole","findHoleBridge","hx","hy","qx","Infinity","m","mx","my","tanMin","tan","abs","sortLinked","q","e","tail","numMerges","pSize","qSize","inSize","leftmost","ax","ay","bx","by","cx","cy","px","py","intersectsPolygon","middleInside","r","p1","p2","q1","q2","inside","a2","Node","b2","an","bp","deviation","polygonArea","trianglesArea","sum","j","flatten","result","vertices","holes","dimensions","holeIndex","d"],"mappings":"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","sourcesContent":["/**\r\n * @author       Richard Davey <rich@photonstorm.com>\r\n * @copyright    2020 Photon Storm Ltd.\r\n * @license      {@link https://opensource.org/licenses/MIT|MIT License}\r\n */\r\n\r\n//  Earcut 2.1.4 (December 4th 2018)\r\n\r\n/*\r\n * ISC License\r\n * \r\n * Copyright (c) 2016, Mapbox\r\n * \r\n * Permission to use, copy, modify, and/or distribute this software for any purpose\r\n * with or without fee is hereby granted, provided that the above copyright notice\r\n * and this permission notice appear in all copies.\r\n * \r\n * THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\n * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND\r\n * FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\n * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\r\n * OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER\r\n * TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF\r\n * THIS SOFTWARE.\r\n */\r\n\r\n'use strict';\r\n\r\nmodule.exports = earcut;\r\n\r\nfunction earcut(data, holeIndices, dim) {\r\n\r\n    dim = dim || 2;\r\n\r\n    var hasHoles = holeIndices && holeIndices.length,\r\n        outerLen = hasHoles ? holeIndices[0] * dim : data.length,\r\n        outerNode = linkedList(data, 0, outerLen, dim, true),\r\n        triangles = [];\r\n\r\n    if (!outerNode || outerNode.next === outerNode.prev) return triangles;\r\n\r\n    var minX, minY, maxX, maxY, x, y, invSize;\r\n\r\n    if (hasHoles) outerNode = eliminateHoles(data, holeIndices, outerNode, dim);\r\n\r\n    // if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox\r\n    if (data.length > 80 * dim) {\r\n        minX = maxX = data[0];\r\n        minY = maxY = data[1];\r\n\r\n        for (var i = dim; i < outerLen; i += dim) {\r\n            x = data[i];\r\n            y = data[i + 1];\r\n            if (x < minX) minX = x;\r\n            if (y < minY) minY = y;\r\n            if (x > maxX) maxX = x;\r\n            if (y > maxY) maxY = y;\r\n        }\r\n\r\n        // minX, minY and invSize are later used to transform coords into integers for z-order calculation\r\n        invSize = Math.max(maxX - minX, maxY - minY);\r\n        invSize = invSize !== 0 ? 1 / invSize : 0;\r\n    }\r\n\r\n    earcutLinked(outerNode, triangles, dim, minX, minY, invSize);\r\n\r\n    return triangles;\r\n}\r\n\r\n// create a circular doubly linked list from polygon points in the specified winding order\r\nfunction linkedList(data, start, end, dim, clockwise) {\r\n    var i, last;\r\n\r\n    if (clockwise === (signedArea(data, start, end, dim) > 0)) {\r\n        for (i = start; i < end; i += dim) last = insertNode(i, data[i], data[i + 1], last);\r\n    } else {\r\n        for (i = end - dim; i >= start; i -= dim) last = insertNode(i, data[i], data[i + 1], last);\r\n    }\r\n\r\n    if (last && equals(last, last.next)) {\r\n        removeNode(last);\r\n        last = last.next;\r\n    }\r\n\r\n    return last;\r\n}\r\n\r\n// eliminate collinear or duplicate points\r\nfunction filterPoints(start, end) {\r\n    if (!start) return start;\r\n    if (!end) end = start;\r\n\r\n    var p = start,\r\n        again;\r\n    do {\r\n        again = false;\r\n\r\n        if (!p.steiner && (equals(p, p.next) || area(p.prev, p, p.next) === 0)) {\r\n            removeNode(p);\r\n            p = end = p.prev;\r\n            if (p === p.next) break;\r\n            again = true;\r\n\r\n        } else {\r\n            p = p.next;\r\n        }\r\n    } while (again || p !== end);\r\n\r\n    return end;\r\n}\r\n\r\n// main ear slicing loop which triangulates a polygon (given as a linked list)\r\nfunction earcutLinked(ear, triangles, dim, minX, minY, invSize, pass) {\r\n    if (!ear) return;\r\n\r\n    // interlink polygon nodes in z-order\r\n    if (!pass && invSize) indexCurve(ear, minX, minY, invSize);\r\n\r\n    var stop = ear,\r\n        prev, next;\r\n\r\n    // iterate through ears, slicing them one by one\r\n    while (ear.prev !== ear.next) {\r\n        prev = ear.prev;\r\n        next = ear.next;\r\n\r\n        if (invSize ? isEarHashed(ear, minX, minY, invSize) : isEar(ear)) {\r\n            // cut off the triangle\r\n            triangles.push(prev.i / dim);\r\n            triangles.push(ear.i / dim);\r\n            triangles.push(next.i / dim);\r\n\r\n            removeNode(ear);\r\n\r\n            // skipping the next vertex leads to less sliver triangles\r\n            ear = next.next;\r\n            stop = next.next;\r\n\r\n            continue;\r\n        }\r\n\r\n        ear = next;\r\n\r\n        // if we looped through the whole remaining polygon and can't find any more ears\r\n        if (ear === stop) {\r\n            // try filtering points and slicing again\r\n            if (!pass) {\r\n                earcutLinked(filterPoints(ear), triangles, dim, minX, minY, invSize, 1);\r\n\r\n            // if this didn't work, try curing all small self-intersections locally\r\n            } else if (pass === 1) {\r\n                ear = cureLocalIntersections(ear, triangles, dim);\r\n                earcutLinked(ear, triangles, dim, minX, minY, invSize, 2);\r\n\r\n            // as a last resort, try splitting the remaining polygon into two\r\n            } else if (pass === 2) {\r\n                splitEarcut(ear, triangles, dim, minX, minY, invSize);\r\n            }\r\n\r\n            break;\r\n        }\r\n    }\r\n}\r\n\r\n// check whether a polygon node forms a valid ear with adjacent nodes\r\nfunction isEar(ear) {\r\n    var a = ear.prev,\r\n        b = ear,\r\n        c = ear.next;\r\n\r\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\r\n\r\n    // now make sure we don't have other points inside the potential ear\r\n    var p = ear.next.next;\r\n\r\n    while (p !== ear.prev) {\r\n        if (pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\r\n            area(p.prev, p, p.next) >= 0) return false;\r\n        p = p.next;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction isEarHashed(ear, minX, minY, invSize) {\r\n    var a = ear.prev,\r\n        b = ear,\r\n        c = ear.next;\r\n\r\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\r\n\r\n    // triangle bbox; min & max are calculated like this for speed\r\n    var minTX = a.x < b.x ? (a.x < c.x ? a.x : c.x) : (b.x < c.x ? b.x : c.x),\r\n        minTY = a.y < b.y ? (a.y < c.y ? a.y : c.y) : (b.y < c.y ? b.y : c.y),\r\n        maxTX = a.x > b.x ? (a.x > c.x ? a.x : c.x) : (b.x > c.x ? b.x : c.x),\r\n        maxTY = a.y > b.y ? (a.y > c.y ? a.y : c.y) : (b.y > c.y ? b.y : c.y);\r\n\r\n    // z-order range for the current triangle bbox;\r\n    var minZ = zOrder(minTX, minTY, minX, minY, invSize),\r\n        maxZ = zOrder(maxTX, maxTY, minX, minY, invSize);\r\n\r\n    var p = ear.prevZ,\r\n        n = ear.nextZ;\r\n\r\n    // look for points inside the triangle in both directions\r\n    while (p && p.z >= minZ && n && n.z <= maxZ) {\r\n        if (p !== ear.prev && p !== ear.next &&\r\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\r\n            area(p.prev, p, p.next) >= 0) return false;\r\n        p = p.prevZ;\r\n\r\n        if (n !== ear.prev && n !== ear.next &&\r\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, n.x, n.y) &&\r\n            area(n.prev, n, n.next) >= 0) return false;\r\n        n = n.nextZ;\r\n    }\r\n\r\n    // look for remaining points in decreasing z-order\r\n    while (p && p.z >= minZ) {\r\n        if (p !== ear.prev && p !== ear.next &&\r\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\r\n            area(p.prev, p, p.next) >= 0) return false;\r\n        p = p.prevZ;\r\n    }\r\n\r\n    // look for remaining points in increasing z-order\r\n    while (n && n.z <= maxZ) {\r\n        if (n !== ear.prev && n !== ear.next &&\r\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, n.x, n.y) &&\r\n            area(n.prev, n, n.next) >= 0) return false;\r\n        n = n.nextZ;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// go through all polygon nodes and cure small local self-intersections\r\nfunction cureLocalIntersections(start, triangles, dim) {\r\n    var p = start;\r\n    do {\r\n        var a = p.prev,\r\n            b = p.next.next;\r\n\r\n        if (!equals(a, b) && intersects(a, p, p.next, b) && locallyInside(a, b) && locallyInside(b, a)) {\r\n\r\n            triangles.push(a.i / dim);\r\n            triangles.push(p.i / dim);\r\n            triangles.push(b.i / dim);\r\n\r\n            // remove two nodes involved\r\n            removeNode(p);\r\n            removeNode(p.next);\r\n\r\n            p = start = b;\r\n        }\r\n        p = p.next;\r\n    } while (p !== start);\r\n\r\n    return p;\r\n}\r\n\r\n// try splitting polygon into two and triangulate them independently\r\nfunction splitEarcut(start, triangles, dim, minX, minY, invSize) {\r\n    // look for a valid diagonal that divides the polygon into two\r\n    var a = start;\r\n    do {\r\n        var b = a.next.next;\r\n        while (b !== a.prev) {\r\n            if (a.i !== b.i && isValidDiagonal(a, b)) {\r\n                // split the polygon in two by the diagonal\r\n                var c = splitPolygon(a, b);\r\n\r\n                // filter collinear points around the cuts\r\n                a = filterPoints(a, a.next);\r\n                c = filterPoints(c, c.next);\r\n\r\n                // run earcut on each half\r\n                earcutLinked(a, triangles, dim, minX, minY, invSize);\r\n                earcutLinked(c, triangles, dim, minX, minY, invSize);\r\n                return;\r\n            }\r\n            b = b.next;\r\n        }\r\n        a = a.next;\r\n    } while (a !== start);\r\n}\r\n\r\n// link every hole into the outer loop, producing a single-ring polygon without holes\r\nfunction eliminateHoles(data, holeIndices, outerNode, dim) {\r\n    var queue = [],\r\n        i, len, start, end, list;\r\n\r\n    for (i = 0, len = holeIndices.length; i < len; i++) {\r\n        start = holeIndices[i] * dim;\r\n        end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\r\n        list = linkedList(data, start, end, dim, false);\r\n        if (list === list.next) list.steiner = true;\r\n        queue.push(getLeftmost(list));\r\n    }\r\n\r\n    queue.sort(compareX);\r\n\r\n    // process holes from left to right\r\n    for (i = 0; i < queue.length; i++) {\r\n        eliminateHole(queue[i], outerNode);\r\n        outerNode = filterPoints(outerNode, outerNode.next);\r\n    }\r\n\r\n    return outerNode;\r\n}\r\n\r\nfunction compareX(a, b) {\r\n    return a.x - b.x;\r\n}\r\n\r\n// find a bridge between vertices that connects hole with an outer ring and and link it\r\nfunction eliminateHole(hole, outerNode) {\r\n    outerNode = findHoleBridge(hole, outerNode);\r\n    if (outerNode) {\r\n        var b = splitPolygon(outerNode, hole);\r\n        filterPoints(b, b.next);\r\n    }\r\n}\r\n\r\n// David Eberly's algorithm for finding a bridge between hole and outer polygon\r\nfunction findHoleBridge(hole, outerNode) {\r\n    var p = outerNode,\r\n        hx = hole.x,\r\n        hy = hole.y,\r\n        qx = -Infinity,\r\n        m;\r\n\r\n    // find a segment intersected by a ray from the hole's leftmost point to the left;\r\n    // segment's endpoint with lesser x will be potential connection point\r\n    do {\r\n        if (hy <= p.y && hy >= p.next.y && p.next.y !== p.y) {\r\n            var x = p.x + (hy - p.y) * (p.next.x - p.x) / (p.next.y - p.y);\r\n            if (x <= hx && x > qx) {\r\n                qx = x;\r\n                if (x === hx) {\r\n                    if (hy === p.y) return p;\r\n                    if (hy === p.next.y) return p.next;\r\n                }\r\n                m = p.x < p.next.x ? p : p.next;\r\n            }\r\n        }\r\n        p = p.next;\r\n    } while (p !== outerNode);\r\n\r\n    if (!m) return null;\r\n\r\n    if (hx === qx) return m.prev; // hole touches outer segment; pick lower endpoint\r\n\r\n    // look for points inside the triangle of hole point, segment intersection and endpoint;\r\n    // if there are no points found, we have a valid connection;\r\n    // otherwise choose the point of the minimum angle with the ray as connection point\r\n\r\n    var stop = m,\r\n        mx = m.x,\r\n        my = m.y,\r\n        tanMin = Infinity,\r\n        tan;\r\n\r\n    p = m.next;\r\n\r\n    while (p !== stop) {\r\n        if (hx >= p.x && p.x >= mx && hx !== p.x &&\r\n                pointInTriangle(hy < my ? hx : qx, hy, mx, my, hy < my ? qx : hx, hy, p.x, p.y)) {\r\n\r\n            tan = Math.abs(hy - p.y) / (hx - p.x); // tangential\r\n\r\n            if ((tan < tanMin || (tan === tanMin && p.x > m.x)) && locallyInside(p, hole)) {\r\n                m = p;\r\n                tanMin = tan;\r\n            }\r\n        }\r\n\r\n        p = p.next;\r\n    }\r\n\r\n    return m;\r\n}\r\n\r\n// interlink polygon nodes in z-order\r\nfunction indexCurve(start, minX, minY, invSize) {\r\n    var p = start;\r\n    do {\r\n        if (p.z === null) p.z = zOrder(p.x, p.y, minX, minY, invSize);\r\n        p.prevZ = p.prev;\r\n        p.nextZ = p.next;\r\n        p = p.next;\r\n    } while (p !== start);\r\n\r\n    p.prevZ.nextZ = null;\r\n    p.prevZ = null;\r\n\r\n    sortLinked(p);\r\n}\r\n\r\n// Simon Tatham's linked list merge sort algorithm\r\n// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html\r\nfunction sortLinked(list) {\r\n    var i, p, q, e, tail, numMerges, pSize, qSize,\r\n        inSize = 1;\r\n\r\n    do {\r\n        p = list;\r\n        list = null;\r\n        tail = null;\r\n        numMerges = 0;\r\n\r\n        while (p) {\r\n            numMerges++;\r\n            q = p;\r\n            pSize = 0;\r\n            for (i = 0; i < inSize; i++) {\r\n                pSize++;\r\n                q = q.nextZ;\r\n                if (!q) break;\r\n            }\r\n            qSize = inSize;\r\n\r\n            while (pSize > 0 || (qSize > 0 && q)) {\r\n\r\n                if (pSize !== 0 && (qSize === 0 || !q || p.z <= q.z)) {\r\n                    e = p;\r\n                    p = p.nextZ;\r\n                    pSize--;\r\n                } else {\r\n                    e = q;\r\n                    q = q.nextZ;\r\n                    qSize--;\r\n                }\r\n\r\n                if (tail) tail.nextZ = e;\r\n                else list = e;\r\n\r\n                e.prevZ = tail;\r\n                tail = e;\r\n            }\r\n\r\n            p = q;\r\n        }\r\n\r\n        tail.nextZ = null;\r\n        inSize *= 2;\r\n\r\n    } while (numMerges > 1);\r\n\r\n    return list;\r\n}\r\n\r\n// z-order of a point given coords and inverse of the longer side of data bbox\r\nfunction zOrder(x, y, minX, minY, invSize) {\r\n    // coords are transformed into non-negative 15-bit integer range\r\n    x = 32767 * (x - minX) * invSize;\r\n    y = 32767 * (y - minY) * invSize;\r\n\r\n    x = (x | (x << 8)) & 0x00FF00FF;\r\n    x = (x | (x << 4)) & 0x0F0F0F0F;\r\n    x = (x | (x << 2)) & 0x33333333;\r\n    x = (x | (x << 1)) & 0x55555555;\r\n\r\n    y = (y | (y << 8)) & 0x00FF00FF;\r\n    y = (y | (y << 4)) & 0x0F0F0F0F;\r\n    y = (y | (y << 2)) & 0x33333333;\r\n    y = (y | (y << 1)) & 0x55555555;\r\n\r\n    return x | (y << 1);\r\n}\r\n\r\n// find the leftmost node of a polygon ring\r\nfunction getLeftmost(start) {\r\n    var p = start,\r\n        leftmost = start;\r\n    do {\r\n        if (p.x < leftmost.x) leftmost = p;\r\n        p = p.next;\r\n    } while (p !== start);\r\n\r\n    return leftmost;\r\n}\r\n\r\n// check if a point lies within a convex triangle\r\nfunction pointInTriangle(ax, ay, bx, by, cx, cy, px, py) {\r\n    return (cx - px) * (ay - py) - (ax - px) * (cy - py) >= 0 &&\r\n           (ax - px) * (by - py) - (bx - px) * (ay - py) >= 0 &&\r\n           (bx - px) * (cy - py) - (cx - px) * (by - py) >= 0;\r\n}\r\n\r\n// check if a diagonal between two polygon nodes is valid (lies in polygon interior)\r\nfunction isValidDiagonal(a, b) {\r\n    return a.next.i !== b.i && a.prev.i !== b.i && !intersectsPolygon(a, b) &&\r\n           locallyInside(a, b) && locallyInside(b, a) && middleInside(a, b);\r\n}\r\n\r\n// signed area of a triangle\r\nfunction area(p, q, r) {\r\n    return (q.y - p.y) * (r.x - q.x) - (q.x - p.x) * (r.y - q.y);\r\n}\r\n\r\n// check if two points are equal\r\nfunction equals(p1, p2) {\r\n    return p1.x === p2.x && p1.y === p2.y;\r\n}\r\n\r\n// check if two segments intersect\r\nfunction intersects(p1, q1, p2, q2) {\r\n    if ((equals(p1, q1) && equals(p2, q2)) ||\r\n        (equals(p1, q2) && equals(p2, q1))) return true;\r\n    return area(p1, q1, p2) > 0 !== area(p1, q1, q2) > 0 &&\r\n           area(p2, q2, p1) > 0 !== area(p2, q2, q1) > 0;\r\n}\r\n\r\n// check if a polygon diagonal intersects any polygon segments\r\nfunction intersectsPolygon(a, b) {\r\n    var p = a;\r\n    do {\r\n        if (p.i !== a.i && p.next.i !== a.i && p.i !== b.i && p.next.i !== b.i &&\r\n                intersects(p, p.next, a, b)) return true;\r\n        p = p.next;\r\n    } while (p !== a);\r\n\r\n    return false;\r\n}\r\n\r\n// check if a polygon diagonal is locally inside the polygon\r\nfunction locallyInside(a, b) {\r\n    return area(a.prev, a, a.next) < 0 ?\r\n        area(a, b, a.next) >= 0 && area(a, a.prev, b) >= 0 :\r\n        area(a, b, a.prev) < 0 || area(a, a.next, b) < 0;\r\n}\r\n\r\n// check if the middle point of a polygon diagonal is inside the polygon\r\nfunction middleInside(a, b) {\r\n    var p = a,\r\n        inside = false,\r\n        px = (a.x + b.x) / 2,\r\n        py = (a.y + b.y) / 2;\r\n    do {\r\n        if (((p.y > py) !== (p.next.y > py)) && p.next.y !== p.y &&\r\n                (px < (p.next.x - p.x) * (py - p.y) / (p.next.y - p.y) + p.x))\r\n            inside = !inside;\r\n        p = p.next;\r\n    } while (p !== a);\r\n\r\n    return inside;\r\n}\r\n\r\n// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;\r\n// if one belongs to the outer ring and another to a hole, it merges it into a single ring\r\nfunction splitPolygon(a, b) {\r\n    var a2 = new Node(a.i, a.x, a.y),\r\n        b2 = new Node(b.i, b.x, b.y),\r\n        an = a.next,\r\n        bp = b.prev;\r\n\r\n    a.next = b;\r\n    b.prev = a;\r\n\r\n    a2.next = an;\r\n    an.prev = a2;\r\n\r\n    b2.next = a2;\r\n    a2.prev = b2;\r\n\r\n    bp.next = b2;\r\n    b2.prev = bp;\r\n\r\n    return b2;\r\n}\r\n\r\n// create a node and optionally link it with previous one (in a circular doubly linked list)\r\nfunction insertNode(i, x, y, last) {\r\n    var p = new Node(i, x, y);\r\n\r\n    if (!last) {\r\n        p.prev = p;\r\n        p.next = p;\r\n\r\n    } else {\r\n        p.next = last.next;\r\n        p.prev = last;\r\n        last.next.prev = p;\r\n        last.next = p;\r\n    }\r\n    return p;\r\n}\r\n\r\nfunction removeNode(p) {\r\n    p.next.prev = p.prev;\r\n    p.prev.next = p.next;\r\n\r\n    if (p.prevZ) p.prevZ.nextZ = p.nextZ;\r\n    if (p.nextZ) p.nextZ.prevZ = p.prevZ;\r\n}\r\n\r\nfunction Node(i, x, y) {\r\n    // vertex index in coordinates array\r\n    this.i = i;\r\n\r\n    // vertex coordinates\r\n    this.x = x;\r\n    this.y = y;\r\n\r\n    // previous and next vertex nodes in a polygon ring\r\n    this.prev = null;\r\n    this.next = null;\r\n\r\n    // z-order curve value\r\n    this.z = null;\r\n\r\n    // previous and next nodes in z-order\r\n    this.prevZ = null;\r\n    this.nextZ = null;\r\n\r\n    // indicates whether this is a steiner point\r\n    this.steiner = false;\r\n}\r\n\r\n// return a percentage difference between the polygon area and its triangulation area;\r\n// used to verify correctness of triangulation\r\nearcut.deviation = function (data, holeIndices, dim, triangles) {\r\n    var hasHoles = holeIndices && holeIndices.length;\r\n    var outerLen = hasHoles ? holeIndices[0] * dim : data.length;\r\n\r\n    var polygonArea = Math.abs(signedArea(data, 0, outerLen, dim));\r\n    if (hasHoles) {\r\n        for (var i = 0, len = holeIndices.length; i < len; i++) {\r\n            var start = holeIndices[i] * dim;\r\n            var end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\r\n            polygonArea -= Math.abs(signedArea(data, start, end, dim));\r\n        }\r\n    }\r\n\r\n    var trianglesArea = 0;\r\n    for (i = 0; i < triangles.length; i += 3) {\r\n        var a = triangles[i] * dim;\r\n        var b = triangles[i + 1] * dim;\r\n        var c = triangles[i + 2] * dim;\r\n        trianglesArea += Math.abs(\r\n            (data[a] - data[c]) * (data[b + 1] - data[a + 1]) -\r\n            (data[a] - data[b]) * (data[c + 1] - data[a + 1]));\r\n    }\r\n\r\n    return polygonArea === 0 && trianglesArea === 0 ? 0 :\r\n        Math.abs((trianglesArea - polygonArea) / polygonArea);\r\n};\r\n\r\nfunction signedArea(data, start, end, dim) {\r\n    var sum = 0;\r\n    for (var i = start, j = end - dim; i < end; i += dim) {\r\n        sum += (data[j] - data[i]) * (data[i + 1] + data[j + 1]);\r\n        j = i;\r\n    }\r\n    return sum;\r\n}\r\n\r\n// turn a polygon in a multi-dimensional array form (e.g. as in GeoJSON) into a form Earcut accepts\r\nearcut.flatten = function (data) {\r\n    var dim = data[0][0].length,\r\n        result = {vertices: [], holes: [], dimensions: dim},\r\n        holeIndex = 0;\r\n\r\n    for (var i = 0; i < data.length; i++) {\r\n        for (var j = 0; j < data[i].length; j++) {\r\n            for (var d = 0; d < dim; d++) result.vertices.push(data[i][j][d]);\r\n        }\r\n        if (i > 0) {\r\n            holeIndex += data[i - 1].length;\r\n            result.holes.push(holeIndex);\r\n        }\r\n    }\r\n    return result;\r\n};\r\n"]},"metadata":{},"sourceType":"script"}